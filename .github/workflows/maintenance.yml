name: Maintain Webring

on:
    push:
        branches:
            - main
    # schedule:
    #     - cron: 0/15 * * * *

env:
    GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

jobs:
    build:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v3
              with:
                  ref: main
                  token: ${{ secrets.GITHUB_TOKEN }}

            # - uses: pnpm/action-setup@v2
            #   with:
            #       version: 8

            # - uses: actions/setup-node@v3
            #   with:
            #       node-version: 18
            #       cache: "pnpm"

            # - name: Run webring maintainance
            #   run: |
            #       pnpm install
            #       pnpm maintain

            - name: Commit files
              run: |
                  git config --local user.email "iunstable0@gmail.com"
                  git config --local user.name "iUnstable0"
                  git checkout -b auto-maintain-branch
                  echo "bye" >> README.md
                  git add .
                  git commit -m "Maintain Webring"
                  git push origin auto-maintain-branch

            # - name: Create Pull Request
            #   uses: peter-evans/create-pull-request@v5
            #   with:
            #       token: ${{ secrets.GITHUB_TOKEN }}

            - name: Create Pull Request
              uses: peter-evans/create-pull-request@v5
              with:
                  title: "Auto-update file"
                  branch: auto-maintain-branch
                  base: main
                  token: ${{ secrets.GITHUB_TOKEN }}

            - name: Automerge Pull Request
              uses: pascalgn/automerge-action@v0.13.1
              env:
                  GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}"
                  MERGE_LABELS: automerge,!work in progress
                  MERGE_COMMIT_MESSAGE: "Automatic merge of successful checks"
                  MERGE_METHOD: squash # or use merge or rebase
